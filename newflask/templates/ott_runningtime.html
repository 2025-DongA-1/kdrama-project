<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>OTT ë“œë¼ë§ˆ ëŸ¬ë‹íƒ€ì„ ë¹„êµ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='/css/chartTheme.css') }}">

</head>
<body>

  <h1>ğŸ¬ 2020ë…„ ì „í›„ OTT ë“œë¼ë§ˆ ëŸ¬ë‹íƒ€ì„ ë¹„êµ</h1>
  <div class="charts-row">
    <div class="chart-container">
      <h2>2020ë…„ ì´ì „</h2>
      <div class="chart-wrapper">
        <canvas id="ottChart"></canvas>
      </div>
    </div>

    <div class="chart-container">
      <h2>2020ë…„ ì´í›„</h2>
      <div class="chart-wrapper">
        <canvas id="ottChart2"></canvas>
      </div>
    </div>
  </div>
  

  <script>
    // const data = {
    //   labels: ["2010ë…„ëŒ€", "2020ë…„ëŒ€"],
    //   datasets: [
    //     {
    //       label: "1ì‹œê°„ ì´ìƒ",
    //       data: [8, 30],
    //       backgroundColor: "rgba(255, 99, 132, 0.7)"
    //     },
    //     {
    //       label: "1ì‹œê°„ ë¯¸ë§Œ",
    //       data: [12, 25],
    //       backgroundColor: "rgba(54, 162, 235, 0.7)"
    //     }
    //   ]
    // };

    // new Chart(document.getElementById("ottChart"), {
    //   type: "bar",
    //   data: data,
    //   options: {
    //     responsive: true,
    //     plugins: {
    //       legend: { position: "top" },
    //       title: { display: true, text: "OTT ë“œë¼ë§ˆ 1ì‹œê°„ ì´ìƒ / ë¯¸ë§Œ ë¹„êµ" }
    //     },
    //     scales: {
    //       y: { beginAtZero: true, ticks: { stepSize: 5 } }
    //     }
    //   }
    // });

  async function createPieChart2010() {

    // 2D ë Œë”ë§ ì»¨í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
    const piechart2010 = document.getElementById('ottChart').getContext('2d');
    
    new Chart(piechart2010, {
        type: 'pie', // ì°¨íŠ¸ íƒ€ì…: íŒŒì´ ì°¨íŠ¸
        data: {
            labels: ['1ì‹œê°„ ë¯¸ë§Œ', '1ì‹œê°„ ì´ìƒ'], // ê° ì„¸ê·¸ë¨¼íŠ¸ì˜ ë ˆì´ë¸”
            datasets: [{
                data: [12,8], // ê° ì„¸ê·¸ë¨¼íŠ¸ì˜ ê°’
                backgroundColor: ['rgba(255, 99, 132, 0.7)','rgba(54, 162, 235, 0.7)'], // ê° ì„¸ê·¸ë¨¼íŠ¸ì˜ ë°°ê²½ìƒ‰ ë°°ì—´
                borderWidth: 2, // ì„¸ê·¸ë¨¼íŠ¸ ê²½ê³„ì„  ë‘ê»˜
                borderColor: '#fff' // ì„¸ê·¸ë¨¼íŠ¸ ê²½ê³„ì„  ìƒ‰ (í°ìƒ‰)
            }]
        },
        options: {
            responsive: true, // ë°˜ì‘í˜• ì°¨íŠ¸
            maintainAspectRatio: false, // ë¹„ìœ¨ ìœ ì§€ ë¹„í™œì„±í™”
            plugins: {
                legend: {
                    position: 'bottom', // ë²”ë¡€ ìœ„ì¹˜: í•˜ë‹¨
                    labels: {
                        padding: 15, // ë²”ë¡€ í•­ëª© ê°„ ê°„ê²©
                        font: {
                            size: 12 // ë²”ë¡€ í°íŠ¸ í¬ê¸°
                        }
                    }
                },
                title: {
                    display: false // ì œëª© í‘œì‹œ ì•ˆ í•¨
                },
                tooltip: {
                    callbacks: {
                        // íˆ´íŒ ë ˆì´ë¸” ì»¤ìŠ¤í„°ë§ˆì´ì§•: "ë ˆì´ë¸”: ê°’ (í¼ì„¼íŠ¸%)" í˜•ì‹
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.parsed;
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((value / total) * 100).toFixed(1);
                            return `${label}: ${value} (${percentage}%)`;
                        }
                    }
                }
            }
        },
        plugins: [{
            // ì»¤ìŠ¤í…€ í”ŒëŸ¬ê·¸ì¸: ê° íŒŒì´ ì„¸ê·¸ë¨¼íŠ¸ì— í¼ì„¼íŠ¸ í…ìŠ¤íŠ¸ í‘œì‹œ
            afterDatasetsDraw: function(chart) {
                const ctx = chart.ctx; // ìº”ë²„ìŠ¤ ì»¨í…ìŠ¤íŠ¸
                chart.data.datasets.forEach((dataset, i) => {
                    const meta = chart.getDatasetMeta(i);
                    if (!meta.hidden) {
                        meta.data.forEach((element, index) => {
                            // í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ ì„¤ì •
                            ctx.fillStyle = '#fff'; // í…ìŠ¤íŠ¸ ìƒ‰ìƒ (í°ìƒ‰)
                            ctx.font = 'bold 14px Arial'; // í…ìŠ¤íŠ¸ í°íŠ¸
                            ctx.textAlign = 'center'; // í…ìŠ¤íŠ¸ ì •ë ¬: ì¤‘ì•™
                            ctx.textBaseline = 'middle'; // í…ìŠ¤íŠ¸ ê¸°ì¤€ì„ : ì¤‘ê°„

                            // í¼ì„¼íŠ¸ ê³„ì‚°
                            const data = dataset.data[index];
                            const total = dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((data / total) * 100).toFixed(1) + '%';

                            // ì„¸ê·¸ë¨¼íŠ¸ ì¤‘ì•™ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
                            const position = element.tooltipPosition();
                            // í¼ì„¼íŠ¸ í…ìŠ¤íŠ¸ ê·¸ë¦¬ê¸°
                            ctx.fillText(percentage, position.x, position.y);
                        });
                    }
                });
            }
        }]
    });
}

  async function createPieChart2020() {


    // 2D ë Œë”ë§ ì»¨í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
    const piechart2020 = document.getElementById('ottChart2').getContext('2d');
    
    new Chart(piechart2020, {
        type: 'pie', // ì°¨íŠ¸ íƒ€ì…: íŒŒì´ ì°¨íŠ¸
        data: {
            labels: ['1ì‹œê°„ ë¯¸ë§Œ', '1ì‹œê°„ ì´ìƒ'], // ê° ì„¸ê·¸ë¨¼íŠ¸ì˜ ë ˆì´ë¸”
            datasets: [{
                data: [25,30], // ê° ì„¸ê·¸ë¨¼íŠ¸ì˜ ê°’
                backgroundColor: ['rgba(255, 99, 132, 0.7)','rgba(54, 162, 235, 0.7)'], // ê° ì„¸ê·¸ë¨¼íŠ¸ì˜ ë°°ê²½ìƒ‰ ë°°ì—´
                borderWidth: 2, // ì„¸ê·¸ë¨¼íŠ¸ ê²½ê³„ì„  ë‘ê»˜
                borderColor: '#fff' // ì„¸ê·¸ë¨¼íŠ¸ ê²½ê³„ì„  ìƒ‰ (í°ìƒ‰)
            }]
        },
        options: {
            responsive: true, // ë°˜ì‘í˜• ì°¨íŠ¸
            maintainAspectRatio: false, // ë¹„ìœ¨ ìœ ì§€ ë¹„í™œì„±í™”
            plugins: {
                legend: {
                    position: 'bottom', // ë²”ë¡€ ìœ„ì¹˜: í•˜ë‹¨
                    labels: {
                        padding: 15, // ë²”ë¡€ í•­ëª© ê°„ ê°„ê²©
                        font: {
                            size: 12 // ë²”ë¡€ í°íŠ¸ í¬ê¸°
                        }
                    }
                },
                title: {
                    display: false // ì œëª© í‘œì‹œ ì•ˆ í•¨
                },
                tooltip: {
                    callbacks: {
                        // íˆ´íŒ ë ˆì´ë¸” ì»¤ìŠ¤í„°ë§ˆì´ì§•: "ë ˆì´ë¸”: ê°’ (í¼ì„¼íŠ¸%)" í˜•ì‹
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.parsed;
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((value / total) * 100).toFixed(1);
                            return `${label}: ${value} (${percentage}%)`;
                        }
                    }
                }
            }
        },
        plugins: [{
            // ì»¤ìŠ¤í…€ í”ŒëŸ¬ê·¸ì¸: ê° íŒŒì´ ì„¸ê·¸ë¨¼íŠ¸ì— í¼ì„¼íŠ¸ í…ìŠ¤íŠ¸ í‘œì‹œ
            afterDatasetsDraw: function(chart) {
                const ctx = chart.ctx; // ìº”ë²„ìŠ¤ ì»¨í…ìŠ¤íŠ¸
                chart.data.datasets.forEach((dataset, i) => {
                    const meta = chart.getDatasetMeta(i);
                    if (!meta.hidden) {
                        meta.data.forEach((element, index) => {
                            // í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ ì„¤ì •
                            ctx.fillStyle = '#fff'; // í…ìŠ¤íŠ¸ ìƒ‰ìƒ (í°ìƒ‰)
                            ctx.font = 'bold 14px Arial'; // í…ìŠ¤íŠ¸ í°íŠ¸
                            ctx.textAlign = 'center'; // í…ìŠ¤íŠ¸ ì •ë ¬: ì¤‘ì•™
                            ctx.textBaseline = 'middle'; // í…ìŠ¤íŠ¸ ê¸°ì¤€ì„ : ì¤‘ê°„

                            // í¼ì„¼íŠ¸ ê³„ì‚°
                            const data = dataset.data[index];
                            const total = dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((data / total) * 100).toFixed(1) + '%';

                            // ì„¸ê·¸ë¨¼íŠ¸ ì¤‘ì•™ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
                            const position = element.tooltipPosition();
                            // í¼ì„¼íŠ¸ í…ìŠ¤íŠ¸ ê·¸ë¦¬ê¸°
                            ctx.fillText(percentage, position.x, position.y);
                        });
                    }
                });
            }
        }]
    });
}

window.addEventListener('load', function() {
      createPieChart2010();
      createPieChart2020();
    });  
  </script>
</body>
</html>
