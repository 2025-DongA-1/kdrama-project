<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>TV ë“œë¼ë§ˆ ëŸ¬ë‹íƒ€ì„ ë¹„êµ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='/css/chartTheme.css') }}">
</head>
<body>

  <h1>ğŸ“º 2020ë…„ ì „í›„ TV ë“œë¼ë§ˆ ëŸ¬ë‹íƒ€ì„ ë³€í™” ë¹„êµ</h1>

  <div class="charts-row">
    <div class="chart-container">
      <h2>2020ë…„ ì´ì „</h2>
      <div class="chart-wrapper">
        <canvas id="chart2010"></canvas>
      </div>
    </div>

    <div class="chart-container">
      <h2>2020ë…„ ì´í›„</h2>
      <div class="chart-wrapper">
        <canvas id="chart2020"></canvas>
      </div>
    </div>
  </div>

  <script>
    // // âœ… CSVë¥¼ ë¯¸ë¦¬ JSì—ì„œ ì •ë¦¬í•œ ë°ì´í„°ë¼ê³  ê°€ì •
    // // ì‹¤ì œë¡œëŠ” íŒŒì´ì¬ì—ì„œ ê³„ì‚° í›„ ìˆ«ìë§Œ ë„£ìœ¼ë©´ ë¨
    // // ì˜ˆ: 1ì‹œê°„ ì´ìƒ 40í¸, 1ì‹œê°„ ë¯¸ë§Œ 90í¸ ì´ëŸ° ì‹
    // const data_2010 = {
    //   labels: ['1ì‹œê°„ ë¯¸ë§Œ', '1ì‹œê°„ ì´ìƒ'],
    //   datasets: [{
    //     label: 'ë“œë¼ë§ˆ ê°œìˆ˜',
    //     data: [30,112 ], // â† ì´ ë¶€ë¶„ë§Œ ì‹¤ì œ ë°ì´í„°ë¡œ ë°”ê¿”ì£¼ë©´ ë¼!
    //     backgroundColor: ['#6EC1E4', '#FFA500']
    //   }]
    // };

    // const data_2020 = {
    //   labels: ['1ì‹œê°„ ë¯¸ë§Œ', '1ì‹œê°„ ì´ìƒ'],
    //   datasets: [{
    //     label: 'ë“œë¼ë§ˆ ê°œìˆ˜',
    //     data: [ 11,94], // â† ì—¬ê¸°ë„ ë°”ê¾¸ë©´ ë¨
    //     backgroundColor: ['#6EC1E4', '#FFA500']
    //   }]
    // };

    // const options = {
    //   scales: {
    //     y: {
    //       beginAtZero: true,
    //       ticks: { stepSize: 10 }
    //     }
    //   },
    //   plugins: {
    //     legend: { display: false },
    //     tooltip: { enabled: true }
    //   }
    // };

    // new Chart(document.getElementById('chart2010'), {
    //   type: 'bar',
    //   data: data_2010,
    //   options: options
    // });

    // new Chart(document.getElementById('chart2020'), {
    //   type: 'bar',
    //   data: data_2020,
    //   options: options
    // });

async function createPieChart2010() {
    // // APIë¡œë¶€í„° 2010ë…„ëŒ€ íŒŒì´ ì°¨íŠ¸ ë°ì´í„° ìš”ì²­
    // const response = await fetch('/api/pie-data-2010');
    // const data = await response.json();

    // 2D ë Œë”ë§ ì»¨í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
    const piechart2010 = document.getElementById('chart2010').getContext('2d');
    
    new Chart(piechart2010, {
        type: 'pie', // ì°¨íŠ¸ íƒ€ì…: íŒŒì´ ì°¨íŠ¸
        data: {
            labels: ['1ì‹œê°„ ë¯¸ë§Œ', '1ì‹œê°„ ì´ìƒ'], // ê° ì„¸ê·¸ë¨¼íŠ¸ì˜ ë ˆì´ë¸”
            datasets: [{
                data: [30,112], // ê° ì„¸ê·¸ë¨¼íŠ¸ì˜ ê°’
                backgroundColor: ['rgba(255, 99, 132, 0.7)','rgba(54, 162, 235, 0.7)'], // ê° ì„¸ê·¸ë¨¼íŠ¸ì˜ ë°°ê²½ìƒ‰ ë°°ì—´
                borderWidth: 2, // ì„¸ê·¸ë¨¼íŠ¸ ê²½ê³„ì„  ë‘ê»˜
                borderColor: '#fff' // ì„¸ê·¸ë¨¼íŠ¸ ê²½ê³„ì„  ìƒ‰ (í°ìƒ‰)
            }]
        },
        options: {
            responsive: true, // ë°˜ì‘í˜• ì°¨íŠ¸
            maintainAspectRatio: false, // ë¹„ìœ¨ ìœ ì§€ ë¹„í™œì„±í™”
            plugins: {
                legend: {
                    position: 'bottom', // ë²”ë¡€ ìœ„ì¹˜: í•˜ë‹¨
                    labels: {
                        padding: 15, // ë²”ë¡€ í•­ëª© ê°„ ê°„ê²©
                        font: {
                            size: 12 // ë²”ë¡€ í°íŠ¸ í¬ê¸°
                        }
                    }
                },
                title: {
                    display: false // ì œëª© í‘œì‹œ ì•ˆ í•¨
                },
                tooltip: {
                    callbacks: {
                        // íˆ´íŒ ë ˆì´ë¸” ì»¤ìŠ¤í„°ë§ˆì´ì§•: "ë ˆì´ë¸”: ê°’ (í¼ì„¼íŠ¸%)" í˜•ì‹
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.parsed;
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((value / total) * 100).toFixed(1);
                            return `${label}: ${value} (${percentage}%)`;
                        }
                    }
                }
            }
        },
        plugins: [{
            // ì»¤ìŠ¤í…€ í”ŒëŸ¬ê·¸ì¸: ê° íŒŒì´ ì„¸ê·¸ë¨¼íŠ¸ì— í¼ì„¼íŠ¸ í…ìŠ¤íŠ¸ í‘œì‹œ
            afterDatasetsDraw: function(chart) {
                const ctx = chart.ctx; // ìº”ë²„ìŠ¤ ì»¨í…ìŠ¤íŠ¸
                chart.data.datasets.forEach((dataset, i) => {
                    const meta = chart.getDatasetMeta(i);
                    if (!meta.hidden) {
                        meta.data.forEach((element, index) => {
                            // í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ ì„¤ì •
                            ctx.fillStyle = '#fff'; // í…ìŠ¤íŠ¸ ìƒ‰ìƒ (í°ìƒ‰)
                            ctx.font = 'bold 14px Arial'; // í…ìŠ¤íŠ¸ í°íŠ¸
                            ctx.textAlign = 'center'; // í…ìŠ¤íŠ¸ ì •ë ¬: ì¤‘ì•™
                            ctx.textBaseline = 'middle'; // í…ìŠ¤íŠ¸ ê¸°ì¤€ì„ : ì¤‘ê°„

                            // í¼ì„¼íŠ¸ ê³„ì‚°
                            const data = dataset.data[index];
                            const total = dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((data / total) * 100).toFixed(1) + '%';

                            // ì„¸ê·¸ë¨¼íŠ¸ ì¤‘ì•™ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
                            const position = element.tooltipPosition();
                            // í¼ì„¼íŠ¸ í…ìŠ¤íŠ¸ ê·¸ë¦¬ê¸°
                            ctx.fillText(percentage, position.x, position.y);
                        });
                    }
                });
            }
        }]
    });
}

async function createPieChart2020() {
    // // APIë¡œë¶€í„° 2020ë…„ëŒ€ íŒŒì´ ì°¨íŠ¸ ë°ì´í„° ìš”ì²­
    // const response = await fetch('/api/pie-data-2010');
    // const data = await response.json();

    // 2D ë Œë”ë§ ì»¨í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
    const piechart2020 = document.getElementById('chart2020').getContext('2d');
    
    new Chart(piechart2020, {
        type: 'pie', // ì°¨íŠ¸ íƒ€ì…: íŒŒì´ ì°¨íŠ¸
        data: {
            labels: ['1ì‹œê°„ ë¯¸ë§Œ', '1ì‹œê°„ ì´ìƒ'], // ê° ì„¸ê·¸ë¨¼íŠ¸ì˜ ë ˆì´ë¸”
            datasets: [{
                data: [11,94], // ê° ì„¸ê·¸ë¨¼íŠ¸ì˜ ê°’
                backgroundColor: ['rgba(255, 99, 132, 0.7)','rgba(54, 162, 235, 0.7)'], // ê° ì„¸ê·¸ë¨¼íŠ¸ì˜ ë°°ê²½ìƒ‰ ë°°ì—´
                borderWidth: 2, // ì„¸ê·¸ë¨¼íŠ¸ ê²½ê³„ì„  ë‘ê»˜
                borderColor: '#fff' // ì„¸ê·¸ë¨¼íŠ¸ ê²½ê³„ì„  ìƒ‰ (í°ìƒ‰)
            }]
        },
        options: {
            responsive: true, // ë°˜ì‘í˜• ì°¨íŠ¸
            maintainAspectRatio: false, // ë¹„ìœ¨ ìœ ì§€ ë¹„í™œì„±í™”
            plugins: {
                legend: {
                    position: 'bottom', // ë²”ë¡€ ìœ„ì¹˜: í•˜ë‹¨
                    labels: {
                        padding: 15, // ë²”ë¡€ í•­ëª© ê°„ ê°„ê²©
                        font: {
                            size: 12 // ë²”ë¡€ í°íŠ¸ í¬ê¸°
                        }
                    }
                },
                title: {
                    display: false // ì œëª© í‘œì‹œ ì•ˆ í•¨
                },
                tooltip: {
                    callbacks: {
                        // íˆ´íŒ ë ˆì´ë¸” ì»¤ìŠ¤í„°ë§ˆì´ì§•: "ë ˆì´ë¸”: ê°’ (í¼ì„¼íŠ¸%)" í˜•ì‹
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.parsed;
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((value / total) * 100).toFixed(1);
                            return `${label}: ${value} (${percentage}%)`;
                        }
                    }
                }
            }
        },
        plugins: [{
            // ì»¤ìŠ¤í…€ í”ŒëŸ¬ê·¸ì¸: ê° íŒŒì´ ì„¸ê·¸ë¨¼íŠ¸ì— í¼ì„¼íŠ¸ í…ìŠ¤íŠ¸ í‘œì‹œ
            afterDatasetsDraw: function(chart) {
                const ctx = chart.ctx; // ìº”ë²„ìŠ¤ ì»¨í…ìŠ¤íŠ¸
                chart.data.datasets.forEach((dataset, i) => {
                    const meta = chart.getDatasetMeta(i);
                    if (!meta.hidden) {
                        meta.data.forEach((element, index) => {
                            // í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ ì„¤ì •
                            ctx.fillStyle = '#fff'; // í…ìŠ¤íŠ¸ ìƒ‰ìƒ (í°ìƒ‰)
                            ctx.font = 'bold 14px Arial'; // í…ìŠ¤íŠ¸ í°íŠ¸
                            ctx.textAlign = 'center'; // í…ìŠ¤íŠ¸ ì •ë ¬: ì¤‘ì•™
                            ctx.textBaseline = 'middle'; // í…ìŠ¤íŠ¸ ê¸°ì¤€ì„ : ì¤‘ê°„

                            // í¼ì„¼íŠ¸ ê³„ì‚°
                            const data = dataset.data[index];
                            const total = dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((data / total) * 100).toFixed(1) + '%';

                            // ì„¸ê·¸ë¨¼íŠ¸ ì¤‘ì•™ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
                            const position = element.tooltipPosition();
                            // í¼ì„¼íŠ¸ í…ìŠ¤íŠ¸ ê·¸ë¦¬ê¸°
                            ctx.fillText(percentage, position.x, position.y);
                        });
                    }
                });
            }
        }]
    });
}

window.addEventListener('load', function() {
      createPieChart2010();
      createPieChart2020();
    });
    
  </script>

</body>
</html>
